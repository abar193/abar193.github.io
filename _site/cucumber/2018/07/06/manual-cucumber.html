<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Running manual Cucumber tests in Java | mrabar.me</title>
<meta name="generator" content="Jekyll v3.8.3" />
<meta property="og:title" content="Running manual Cucumber tests in Java" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Running manual Cucumber tests in Java" />
<meta property="og:description" content="Running manual Cucumber tests in Java" />
<link rel="canonical" href="/cucumber/2018/07/06/manual-cucumber.html" />
<meta property="og:url" content="/cucumber/2018/07/06/manual-cucumber.html" />
<meta property="og:site_name" content="mrabar.me" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-07-06T00:00:00+02:00" />
<script type="application/ld+json">
{"description":"Running manual Cucumber tests in Java","@type":"BlogPosting","headline":"Running manual Cucumber tests in Java","dateModified":"2018-07-06T00:00:00+02:00","datePublished":"2018-07-06T00:00:00+02:00","url":"/cucumber/2018/07/06/manual-cucumber.html","mainEntityOfPage":{"@type":"WebPage","@id":"/cucumber/2018/07/06/manual-cucumber.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="mrabar.me" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">mrabar.me</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/cv/">CV</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Running manual Cucumber tests in Java</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2018-07-06T00:00:00+02:00" itemprop="datePublished">Jul 6, 2018
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h1 id="running-manual-cucumber-tests-in-java">Running manual Cucumber tests in Java</h1>

<p>In theory, it would be nice to have everything automated. In reality, it might be the case that for some reasons you have to run and manually verify test results.</p>

<p>There can be a number of ways for running manual Cucumber tests, for Ruby there’s even whole <a href="https://cukehub.com/">CukeHub</a> to run and organize manual tests, but my research yielded no results on how to do manual testing in Java.</p>

<p>So, let’s implement it our self.</p>

<h2 id="used-example">Used example</h2>

<p>I picked some simple <a href="https://github.com/pavradev/cucumber-demo">demo for ATM</a>. It had some outdated dependencies, but could serve as a good starting point.</p>

<h2 id="defining-feature">Defining feature</h2>

<p>Let’s take one of scenarios in feature file and add the desired functionality</p>

<h6 id="srctestresourcesatmwithdrawfeature">src/test/resources/atm/withdraw.feature</h6>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    @manual
    Scenario: Manual test 1
        Given I have 50 SEK on my account
        When I withdraw -1 SEK
        Then I get 0 SEK from the ATM
        And error message about incorrect amount is displayed
        And evaluate manually
</code></pre></div></div>

<p>Step we want is the last one. Cucumber should run its tests, evaluate some of the results and then await for users’ final decision. Since we want to exclude manual tests from automated runs, we should also annotate those scenarios somehow. I went with ‘@manual’ tag.</p>

<p>Now to define this step</p>

<h6 id="srctestjavaatmwithdrawstepsjava">src/test/java/atm/WithdrawSteps.java</h6>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nd">@Then</span><span class="o">(</span><span class="s">"^evaluate manually$"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">evaluate_manually</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Throwable</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Mark feature as [p]assed or [f]ailed?"</span><span class="o">);</span>
        <span class="n">Scanner</span> <span class="n">sc</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Scanner</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">in</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="na">nextLine</span><span class="o">();</span>
        <span class="k">while</span> <span class="o">(!</span><span class="n">s</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"f"</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">s</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"p"</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Unknown input: "</span> <span class="o">+</span> <span class="n">s</span><span class="o">);</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="na">nextLine</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="s">"User marked test as failed"</span><span class="o">,</span> <span class="n">s</span><span class="o">,</span> <span class="n">is</span><span class="o">(</span><span class="s">"p"</span><span class="o">));</span>
    <span class="o">}</span>
</code></pre></div></div>

<p>Keep asking user to provide his assessment until he finally gives up and gives us what we want — either “p” or “f”. Then throw an exception if input isn’t “p”. With such simple code nothing can go wrong, right?</p>

<p>Wrong.</p>

<h2 id="problem-with-maven">Problem with Maven</h2>

<p>If you run your Cucumber tests with ‘mvn clean test’ (the way every Cucumber tutorial suggests) then you get but one problem.
Maven blocks System input, preventing our Scanner from giving us any input – no matter how hard user smashes his “enter” key, our app just won’t receive a single line of input and will stay soft locked.</p>

<p>To work around this problem and get an easy-to-use solution we need 2 components. One is ‘exec-maven-plugin’, which allows us to execute custom java code bypassing mvn test restrictions, and second is <a href="https://github.com/cucumber/cucumber-jvm/blob/master/core/src/main/resources/cucumber/api/cli/USAGE.txt">cucumber.api.cli.Main usage info</a>. All we need to do is add exec-maven-plugin, specify ‘mainClass’ as ‘cucumber.api.cli.Main’, define ‘classpathScope’ as ‘test’ and provide in arguments path to our feature and glue code files, and Cucumber plugins.</p>

<h2 id="result">Result</h2>

<h6 id="pomxml">pom.xml</h6>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nt">&lt;plugin&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.codehaus.mojo<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>exec-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>1.6.0<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;executions&gt;</span>
            <span class="nt">&lt;execution&gt;</span>
                <span class="nt">&lt;goals&gt;</span>
                    <span class="nt">&lt;goal&gt;</span>java<span class="nt">&lt;/goal&gt;</span>
                <span class="nt">&lt;/goals&gt;</span>
                <span class="c">&lt;!-- Uncomment the following line if you want to run manual tests with mvn test command --&gt;</span>
                <span class="c">&lt;!--&lt;phase&gt;test&lt;/phase&gt;--&gt;</span>
            <span class="nt">&lt;/execution&gt;</span>
        <span class="nt">&lt;/executions&gt;</span>
        <span class="nt">&lt;configuration&gt;</span>
            <span class="nt">&lt;mainClass&gt;</span>cucumber.api.cli.Main<span class="nt">&lt;/mainClass&gt;</span>
            <span class="nt">&lt;classpathScope&gt;</span>test<span class="nt">&lt;/classpathScope&gt;</span>
            <span class="nt">&lt;arguments&gt;</span>
                <span class="c">&lt;!-- Specify the location of .feature files --&gt;</span>
                <span class="nt">&lt;argument&gt;</span>classpath:atm<span class="nt">&lt;/argument&gt;</span>
                <span class="c">&lt;!-- Specify the location of gluecode classes - in our case that's WithdrawSteps --&gt;</span>
                <span class="nt">&lt;argument&gt;</span>--glue<span class="nt">&lt;/argument&gt;</span>
                <span class="nt">&lt;argument&gt;</span>classpath:atm<span class="nt">&lt;/argument&gt;</span>
                <span class="c">&lt;!-- Define plugins - first one ensures that console output is colorful,
                    second one gives location for report file --&gt;</span>
                <span class="nt">&lt;argument&gt;</span>--plugin<span class="nt">&lt;/argument&gt;</span>
                <span class="nt">&lt;argument&gt;</span>pretty<span class="nt">&lt;/argument&gt;</span>
                <span class="nt">&lt;argument&gt;</span>-p<span class="nt">&lt;/argument&gt;</span>
                <span class="nt">&lt;argument&gt;</span>json:target/cucumber/manual.json<span class="nt">&lt;/argument&gt;</span>
                <span class="c">&lt;!-- Cucumber Tag expression.  --&gt;</span>
                <span class="nt">&lt;argument&gt;</span>--tags<span class="nt">&lt;/argument&gt;</span>
                <span class="nt">&lt;argument&gt;</span>@manual<span class="nt">&lt;/argument&gt;</span>
            <span class="nt">&lt;/arguments&gt;</span>
        <span class="nt">&lt;/configuration&gt;</span>
    <span class="nt">&lt;/plugin&gt;</span> 
</code></pre></div></div>

<p>I find it best to annotate Runner class to prevent manual tests from being executed with automated:</p>

<h6 id="srctestjavaatmruncukestestjava">src/test/java/atm/RunCukesTest.java</h6>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RunWith</span><span class="o">(</span><span class="n">Cucumber</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@CucumberOptions</span><span class="o">(</span><span class="n">plugin</span> <span class="o">=</span> <span class="o">{</span><span class="s">"pretty"</span><span class="o">,</span> <span class="s">"json:target/cucumber/cucumber.json"</span><span class="o">},</span>
        <span class="n">tags</span> <span class="o">=</span> <span class="o">{</span><span class="s">"not @manual"</span><span class="o">})</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RunCukesTest</span> <span class="o">{</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="running">Running</h2>

<p>Now we can run automated tests with <code class="highlighter-rouge">mvn test</code> and manual with <code class="highlighter-rouge">mvn test-compile exec:java</code>. 
With current configuration it will provide 2 json report files which can be merged in several ways, depending on how you store your results.</p>

<p>If you prefer to have results in html format, you can merge reports by copying one report.js file starting from second line and excluding last into penultimate line of another report.js.</p>

<h2 id="example">Example</h2>

<p>Complete example for this post can be found <a href="https://github.com/abar193/cucumber-demo">here</a>.</p>

  </div><a class="u-url" href="/cucumber/2018/07/06/manual-cucumber.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">mrabar.me</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">mrabar.me</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/abar193"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">abar193</span></a></li><li><a href="https://www.linkedin.com/in/mrabar"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#linkedin"></use></svg> <span class="username">mrabar</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>This website originally served as a simple CV page, but sometimes  (typically: when I&#39;m looking for a job) I&#39;m writing some small blog posts related to my work. I hope they can be useful. </p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
